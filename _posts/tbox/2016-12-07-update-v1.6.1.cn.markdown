---
layout: post.cn
title:  "tbox v1.6.1更新，新增stackless协程支持"
tags: tbox stackless 协程 版本更新
categories: tbox
---

此版本主要增加stackless协程模块以及为嵌入式平台增加micro微模块编译(~64K)。

此stackless协程模块比之前的stackfull协程实现更加的轻量高效，切换效率提升5、6倍，在macosx上测试1000w次切换仅需40ms

当然易用性和灵活性上，还是stackfull模式更有优势（tbox两种模式都已支持，接口类似）。

stackless协程使用见：[stackless协程使用文档](/cn/2016/12/03/stackless-coroutine/)
stackfull协程使用见：[stackfull协程使用文档](/cn/2016/10/29/coroutine-switch/)

更多协程服务器demo实现，请参考：[协程examples](https://github.com/waruqi/tbox/tree/master/src/demo/coroutine)

### 新特性

* 针对协程上下文切换，支持mips架构
* 添加`__tb_thread_local__`关键字宏
* 添加 `--micro=y|n` 选项，实现极小编译，针对嵌入式平台，编译tbox微内核(~64K) 
* 添加 `tb_addrinfo_addr` and `tb_addrinfo_name` 接口
* 添加stackless协程，更加轻量的协程支持，每个协程只占用几十个bytes，同时支持io调度
* 针对stackless协程，增加lock和semaphone支持

### 改进

* 为协程优化io调度器，缓存poller轮询等待，减少频繁重复调用epoll_ctl, kevent等系统接口
* 添加对c11关键字_Static_assert的支持
* 针对hash和platform模块，移除一些废弃的接口


